<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° Tollbooth Seeker AI</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ffd700;
        }

        .header p {
            font-size: 1.1rem;
            color: #b8d4ff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: #b8d4ff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: #ffd700;
        }

        .controls {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .controls-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-group label {
            font-size: 0.9rem;
            color: #b8d4ff;
        }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .btn.active {
            background: #ffd700;
            color: #1e3c72;
            border-color: #ffd700;
        }

        .signals-container {
            display: grid;
            gap: 20px;
        }

        .signal-card {
            background: rgba(255, 255, 255, 0.95);
            color: #1e3c72;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .signal-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .signal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e3c72;
            flex: 1;
        }

        .signal-score {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.2rem;
            min-width: 80px;
            text-align: center;
        }

        .signal-score.high {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .signal-score.exceptional {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .signal-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            color: #5a6c7d;
        }

        .meta-item strong {
            color: #2a5298;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .score-item {
            background: #f0f4f8;
            padding: 12px;
            border-radius: 8px;
        }

        .score-item-label {
            font-size: 0.8rem;
            color: #5a6c7d;
            margin-bottom: 4px;
        }

        .score-item-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2a5298;
        }

        .progress-bar {
            height: 4px;
            background: #e0e7ef;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 4px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .breadcrumbs {
            margin-bottom: 16px;
        }

        .breadcrumbs-title {
            font-size: 0.9rem;
            color: #5a6c7d;
            margin-bottom: 8px;
        }

        .breadcrumb-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .breadcrumb {
            background: #e8f0fe;
            color: #2a5298;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
        }

        .early-movers {
            margin-bottom: 16px;
        }

        .early-movers-title {
            font-size: 0.9rem;
            color: #5a6c7d;
            margin-bottom: 8px;
        }

        .movers-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .mover {
            background: #fff4e6;
            color: #c17500;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .signal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid #e0e7ef;
        }

        .toll-mechanism {
            font-size: 0.9rem;
            color: #5a6c7d;
        }

        .toll-mechanism strong {
            color: #2a5298;
        }

        .signal-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: transparent;
            border: 1px solid #2a5298;
            color: #2a5298;
            padding: 6px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: #2a5298;
            color: white;
        }

        .action-btn.watchlist {
            background: #ffd700;
            border-color: #ffd700;
            color: #1e3c72;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
        }

        .empty {
            text-align: center;
            padding: 60px;
            color: #b8d4ff;
        }

        @media (max-width: 768px) {
            .score-breakdown {
                grid-template-columns: 1fr;
            }
            
            .controls-row {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function TollboothDashboard() {
            const [stats, setStats] = useState(null);
            const [signals, setSignals] = useState([]);
            const [loading, setLoading] = useState(true);
            const [selectedSector, setSelectedSector] = useState('all');
            const [sortBy, setSortBy] = useState('score');

            useEffect(() => {
                loadData();
                const interval = setInterval(loadData, 30000); // Refresh every 30 seconds
                return () => clearInterval(interval);
            }, []);

            const loadData = async () => {
                try {
                    const [statsRes, signalsRes] = await Promise.all([
                        fetch('http://localhost:5000/api/dashboard'),
                        fetch('http://localhost:5000/api/signals')
                    ]);
                    
                    const statsData = await statsRes.json();
                    const signalsData = await signalsRes.json();
                    
                    setStats(statsData);
                    setSignals(signalsData);
                    setLoading(false);
                } catch (error) {
                    console.error('Error loading data:', error);
                    setLoading(false);
                }
            };

            const addToWatchlist = async (signalId) => {
                try {
                    await fetch(`http://localhost:5000/api/watchlist/add/${signalId}`, {
                        method: 'POST'
                    });
                    alert('Added to watchlist!');
                } catch (error) {
                    console.error('Error adding to watchlist:', error);
                }
            };

            const filteredSignals = signals
                .filter(s => selectedSector === 'all' || s.sector === selectedSector)
                .sort((a, b) => {
                    if (sortBy === 'score') return b.total_score - a.total_score;
                    if (sortBy === 'timing') return b.timing_score - a.timing_score;
                    if (sortBy === 'moat') return b.moat_score - a.moat_score;
                    return 0;
                });

            if (loading) {
                return <div className="loading">‚ö° Loading signals...</div>;
            }

            return (
                <div className="container">
                    <div className="header">
                        <h1>‚ö° Tollbooth Seeker AI</h1>
                        <p>Infrastructure Chokepoint Intelligence Engine ¬∑ Detecting tomorrow's mandatory rails</p>
                    </div>

                    {stats && (
                        <div className="stats-grid">
                            <div className="stat-card">
                                <h3>üîç Active Signals</h3>
                                <div className="value">{stats.active_signals}</div>
                            </h3>
                            </div>
                            <div className="stat-card">
                                <h3>‚≠ê Avg Score</h3>
                                <div className="value">{stats.avg_score}</div>
                            </div>
                            <div className="stat-card">
                                <h3>üìà High Priority</h3>
                                <div className="value">{stats.high_priority}</div>
                            </div>
                            <div className="stat-card">
                                <h3>üíé Hidden Gems</h3>
                                <div className="value">{stats.hidden_gems}</div>
                            </div>
                        </div>
                    )}

                    <div className="controls">
                        <div className="controls-row">
                            <div className="control-group">
                                <label>Sector:</label>
                                <button 
                                    className={`btn ${selectedSector === 'all' ? 'active' : ''}`}
                                    onClick={() => setSelectedSector('all')}
                                >
                                    all
                                </button>
                                <button 
                                    className={`btn ${selectedSector === 'AI' ? 'active' : ''}`}
                                    onClick={() => setSelectedSector('AI')}
                                >
                                    AI
                                </button>
                                <button 
                                    className={`btn ${selectedSector === 'Compute' ? 'active' : ''}`}
                                    onClick={() => setSelectedSector('Compute')}
                                >
                                    Compute
                                </button>
                                <button 
                                    className={`btn ${selectedSector === 'Finance' ? 'active' : ''}`}
                                    onClick={() => setSelectedSector('Finance')}
                                >
                                    Finance
                                </button>
                                <button 
                                    className={`btn ${selectedSector === 'Bio' ? 'active' : ''}`}
                                    onClick={() => setSelectedSector('Bio')}
                                >
                                    Bio
                                </button>
                            </div>
                            
                            <div className="control-group">
                                <label>Sort by:</label>
                                <button 
                                    className={`btn ${sortBy === 'score' ? 'active' : ''}`}
                                    onClick={() => setSortBy('score')}
                                >
                                    Score
                                </button>
                                <button 
                                    className={`btn ${sortBy === 'timing' ? 'active' : ''}`}
                                    onClick={() => setSortBy('timing')}
                                >
                                    Timing
                                </button>
                                <button 
                                    className={`btn ${sortBy === 'moat' ? 'active' : ''}`}
                                    onClick={() => setSortBy('moat')}
                                >
                                    Moat
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="signals-container">
                        {filteredSignals.length === 0 ? (
                            <div className="empty">
                                No signals found. Run the detection engine to populate the database.
                            </div>
                        ) : (
                            filteredSignals.map(signal => (
                                <SignalCard 
                                    key={signal.id} 
                                    signal={signal} 
                                    onAddToWatchlist={addToWatchlist}
                                />
                            ))
                        )}
                    </div>
                </div>
            );
        }

        function SignalCard({ signal, onAddToWatchlist }) {
            const breadcrumbs = JSON.parse(signal.breadcrumbs || '[]');
            const earlyMovers = JSON.parse(signal.early_movers || '[]');
            
            const getScoreClass = (score) => {
                if (score >= 9.0) return 'exceptional';
                if (score >= 8.5) return 'high';
                return '';
            };

            return (
                <div className="signal-card">
                    <div className="signal-header">
                        <div className="signal-title">{signal.title}</div>
                        <div className={`signal-score ${getScoreClass(signal.total_score)}`}>
                            {signal.total_score.toFixed(1)}
                        </div>
                    </div>

                    <div className="signal-meta">
                        <div className="meta-item">
                            <strong>Sector:</strong> {signal.sector}
                        </div>
                        <div className="meta-item">
                            <strong>Source:</strong> {signal.source}
                        </div>
                    </div>

                    <div className="score-breakdown">
                        <div className="score-item">
                            <div className="score-item-label">Inevitability</div>
                            <div className="score-item-value">{signal.inevitability_score.toFixed(0)}%</div>
                            <div className="progress-bar">
                                <div 
                                    className="progress-fill" 
                                    style={{width: `${signal.inevitability_score}%`}}
                                ></div>
                            </div>
                        </div>
                        <div className="score-item">
                            <div className="score-item-label">Moat Potential</div>
                            <div className="score-item-value">{signal.moat_score.toFixed(0)}%</div>
                            <div className="progress-bar">
                                <div 
                                    className="progress-fill" 
                                    style={{width: `${signal.moat_score}%`}}
                                ></div>
                            </div>
                        </div>
                        <div className="score-item">
                            <div className="score-item-label">Timing Window</div>
                            <div className="score-item-value">{signal.timing_score.toFixed(0)}%</div>
                            <div className="progress-bar">
                                <div 
                                    className="progress-fill" 
                                    style={{width: `${signal.timing_score}%`}}
                                ></div>
                            </div>
                        </div>
                    </div>

                    {breadcrumbs.length > 0 && (
                        <div className="breadcrumbs">
                            <div className="breadcrumbs-title">Signals Detected:</div>
                            <div className="breadcrumb-list">
                                {breadcrumbs.slice(0, 5).map((crumb, i) => (
                                    <div key={i} className="breadcrumb">{crumb}</div>
                                ))}
                            </div>
                        </div>
                    )}

                    {earlyMovers.length > 0 && (
                        <div className="early-movers">
                            <div className="early-movers-title">Early Movers:</div>
                            <div className="movers-list">
                                {earlyMovers.slice(0, 5).map((mover, i) => (
                                    <div key={i} className="mover">{mover}</div>
                                ))}
                            </div>
                        </div>
                    )}

                    <div className="signal-footer">
                        <div className="toll-mechanism">
                            <strong>Toll Mechanism:</strong> {signal.toll_mechanism}
                        </div>
                        <div className="signal-actions">
                            <button 
                                className="action-btn"
                                onClick={() => window.open(signal.url, '_blank')}
                            >
                                View Source
                            </button>
                            <button 
                                className="action-btn watchlist"
                                onClick={() => onAddToWatchlist(signal.id)}
                            >
                                ‚≠ê Watchlist
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TollboothDashboard />, document.getElementById('root'));
    </script>
</body>
</html>
